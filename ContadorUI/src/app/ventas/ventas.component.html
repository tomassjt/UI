<!--colocamos el loading dependiendo de la variable loading-->
<app-loading *ngIf="this.loading"></app-loading> 

<div style="min-width:100%;  width:100% !important;  ">

  <h1>Cargas</h1>
  <h1 style="font-size:20px;">{{this.RESULTADO}}</h1>

  <i class="fas fa-chevron-right iconoDeFiltro" (click)="switchearVentanaFiltros()"></i>
  <label style="margin:10px;">{{filtrosAbiertos ? 'Cerrar filtros' : 'Abrir filtros filtrar Facturas'}} </label>
  <div [class.filtroAbierto]="filtrosAbiertos" [class.filtroCerrado]="!filtrosAbiertos">
    <!--FILTRAR FACTURA-->
    <div class="formulario">
      <form (submit)=" filtrarFacturaCompleto()" class="form-group" style="display: flex; flex-wrap: wrap; width: 300px; height:auto; justify-content: flex-end; align-items: center; margin-right: 10px; ">
        <label style="color: #444;  margin-bottom: 10px;">Campos obligatorios</label>
        <div>
          <label for="Tipo">Numero de guia:</label>
          <input type="number" id="Tipo" name="Tipo" (blur)="cargaNumeroChange($event)" [(ngModel)]="filtro.cargaNumero">
        </div>

        <div>
          <label>Camionero</label>
          <select (blur)="camioneroselectChangeFiltro($event)">
            <option *ngFor="let camionero of camioneros" [value]="camionero.Id" >
              {{ camionero.Id }} - {{ camionero.Nombre }}
            </option>
          </select>


        </div>

        <div>
          <label>Cliente</label>
          <select (blur)="clienteselectChangeFiltro($event)">
            <option *ngFor="let cliente of clientes" [value]="cliente.id" [attr.data-nombre]="cliente.nombre">
              {{ cliente.NumeroDeCliente }} - {{ cliente.nombre }}
            </option>
          </select>


        </div>
        <br />
        <hr />
        <br />
        <label style="color:#444; margin-top:30px; margin-bottom:10px;">Campos opcionales</label>
        <br />
        <div>
          <label for="nombre">punto:</label>
          <input type="number" id="Punto" name="Punto" [(ngModel)]="filtro.Punto">
        </div>
        <div>
          <label for="direccion">numero:</label>
          <input type="number" id="Numero" name="Numero" [(ngModel)]="filtro.Numero">
        </div>



        <label for="fechaDesde">Fecha Desde:</label>
        <input type="date" (blur)="SendDataonChangeDesde($event)" [(ngModel)]="filtro.FechaDesde" />
        <label for="fechaHasta">Fecha Hasta:</label>
        <input type="date" (blur)="SendDataonChangeHasta($event)" [(ngModel)]="filtro.FechaHasta" />





        <div>
          <label>Vendedor</label>
          <select (change)="vendedorselectFiltroChange($event)">
            <option *ngFor="let vendedor of vendedores" [value]="vendedor.id">
              {{ vendedor.id }} - {{ vendedor.nombre }}
            </option>
          </select>
        </div>

      </form>
      <button type="submit" class="btn btn-primary btn-sm " style="margin-right:5px;" (click)="filtrarFacturaCompleto()">Filtrar Factura</button>
      <button class="btn  btn-primary btn-sm " style="margin-right:5px;" (click)="limpiarFiltros()">Limpiar Filtros</button>
      <button class="btn  btn-primary btn-sm " style="margin-right:5px;" (click)="obtenerFacturas()">Ver Todas</button>


    </div>




  </div>

  <div style="margin-top:20px; margin-bottom:20px;">
    <h4>Resumen</h4>
    <h4>Clientes deudores: {{this.clientesPorCobrar}}</h4>
    <h4>Cantidad total de facturas:{{this.cantidadTotalFacturas}}</h4>
    <h4>Cantidad de facturas por pagar: {{this.facturasPorCobrar}}</h4>
    <h4>Cantidad de facturas cobradas:{{this.facturasCobradas}}</h4>
    <h4>Dinero por cobrar: ${{this.dineroPorCobrar}}</h4>

  </div>
  <div >
    <button [disabled]="this.filtro.Camionero == undefined || this.filtro.Cliente == undefined ||  this.filtro.cargaNumero == undefined" class="btn  btn-primary btn-sm " style="margin-right:5px; margin:20px;" (click)="imprimir()"> Imprimir Tiket</button>
    <button [disabled]="this.filtro.Camionero == undefined || this.filtro.Cliente == undefined ||  this.filtro.cargaNumero == undefined" class="btn  btn-primary btn-sm " style=" margin-right:5px; margin:20px;" (click)="enviarWsp()">Enviar WhatsApp a camionero</button>
    <button [disabled]="this.filtro.Camionero == undefined || this.filtro.Cliente == undefined ||  this.filtro.cargaNumero == undefined" class="btn  btn-primary btn-sm " style=" margin-right:5px; margin:20px;" (click)="enviarWspAdmin()">Enviar WhatsApp a admin</button>
  </div>
  <label style="color:red;"  *ngIf="this.filtro.Camionero == undefined || this.filtro.Cliente == undefined ||  this.filtro.cargaNumero == undefined">
   *Debe definir un n√∫mero de guia, un camionero, y un cliente para poder imprimir tiket o enviar informe por wsp. Los otros filtros no son obligatorios.
  </label>
  <br />
  <!--<div *ngFor="let cli of this.Clientes">
    <p>{{cli.id}} {{cli.nombre}}</p>
  </div>-->



  <div style="margin-top:20px;  max-width:1000px; font-size:12px;">
    <!-- En tu componente HTML -->
    <h4>h4Facturasno entregadas</h4>
    <div class="mat-elevation-z8">

      <mat-table [dataSource]="dataSource">
        <!-- Columnas -->
        <ng-container matColumnDef="id" class="columna">
          <th mat-header-cell *matHeaderCellDef class="columna">Id Factura</th>
          <td mat-cell *matCellDef="let element" class="columna"> {{element.id}} </td>
        </ng-container>

        <ng-container matColumnDef="Guia" class="columna">
          <th mat-header-cell *matHeaderCellDef class="columna">Nro Guia</th>
          <td mat-cell *matCellDef="let element" class="columna"> {{element.cargaNumero}} </td>
        </ng-container>


        <ng-container matColumnDef="Camionero" class="columna">
          <th mat-header-cell *matHeaderCellDef class="columna">Camionero</th>
          <td mat-cell *matCellDef="let element" class="columna"> {{element.Camionero}} </td>
        </ng-container>

        <ng-container matColumnDef="Cliente" class="columna">
          <th mat-header-cell *matHeaderCellDef class="columna">Cliente id</th>
          <td mat-cell *matCellDef="let element" class="columna"> {{obtenerNumeroDeCliente(element.Cliente)}} </td>
        </ng-container>



        <ng-container matColumnDef="Fecha" class="columna" style="width:300px;">
          <th mat-header-cell *matHeaderCellDef class="columna" style="width:300px;"> Fecha </th>
          <td mat-cell *matCellDef="let element" class="columna" style="width:300px;"> {{element.Fecha}} </td>
        </ng-container>


        <ng-container matColumnDef="Monto" class="columna">
          <th mat-header-cell *matHeaderCellDef> Monto </th>
          <td mat-cell *matCellDef="let element" class="columna"> ${{element.Monto}} </td>
        </ng-container>



        <!-- Asigna las columnas y las acciones a la tabla -->
        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row style="height:40px;" *matRowDef="let row; columns: displayedColumns"></mat-row>
      </mat-table>
      <mat-paginator #paginator
                     [pageSizeOptions]="[5, 10, 20]"
                     showFirstLastButtons>
      </mat-paginator>


    </div>

  </div>









  <div class="tablas-container" style="display:block; height:auto;   width:1300px!important; min-width:100% !important;   margin-top:10px;">
    <h4>Facturas entregadas</h4>

    <div style="margin-top:20px;  max-width:1000px; font-size:12px;">
      <!-- En tu componente HTML -->
      <div class="mat-elevation-z8">
        <mat-table [dataSource]="dataSourceEntregadas">
          <!-- Columnas -->
          <ng-container matColumnDef="id" class="columna">
            <th mat-header-cell *matHeaderCellDef class="columna">Id Factura</th>
            <td mat-cell *matCellDef="let element" class="columna"> {{element.id}} </td>
          </ng-container>

          <ng-container matColumnDef="Guia" class="columna">
            <th mat-header-cell *matHeaderCellDef class="columna">Nro Guia</th>
            <td mat-cell *matCellDef="let element" class="columna"> {{element.cargaNumero}} </td>
          </ng-container>

          <ng-container matColumnDef="Cliente" class="columna">
            <th mat-header-cell *matHeaderCellDef class="columna">Cliente id</th>
            <td mat-cell *matCellDef="let element" class="columna">  {{obtenerNumeroDeCliente(element.Cliente)}} </td>
          </ng-container>



          <ng-container matColumnDef="Fecha" class="columna" style="width:300px;">
            <th mat-header-cell *matHeaderCellDef class="columna" style="width:300px;"> Fecha </th>
            <td mat-cell *matCellDef="let element" class="columna" style="width:300px;"> {{element.Fecha}} </td>
          </ng-container>

          <ng-container matColumnDef="FEntrega" class="columna">
            <th mat-header-cell *matHeaderCellDef class="columna"> Fecha de Entrega </th>
            <td mat-cell *matCellDef="let element" class="columna"> {{element.FechaEntrega}} </td>
          </ng-container>

          <ng-container matColumnDef="Monto" class="columna">
            <th mat-header-cell *matHeaderCellDef class="columna"> Monto. </th>
            <td mat-cell *matCellDef="let element" class="columna"> $ {{element.Monto}} </td>
          </ng-container>





          <!-- Asigna las columnas y las acciones a la tabla -->
          <mat-header-row *matHeaderRowDef="displayedColumnsEntregadas"></mat-header-row>
          <mat-row style="height:40px;" *matRowDef="let row; columns: displayedColumnsEntregadas"></mat-row>
        </mat-table>

        <mat-paginator #pag2
                       [pageSizeOptions]="[5, 10, 20]"
                       showFirstLastButtons>
        </mat-paginator>

      </div>


    </div>

  </div>
</div>
